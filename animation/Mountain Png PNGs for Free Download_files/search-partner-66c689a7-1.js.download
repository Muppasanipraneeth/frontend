var d=Object.defineProperty;var m=(i,t,e)=>t in i?d(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var r=(i,t,e)=>(m(i,typeof t!="symbol"?t+"":t,e),e);import{_ as p}from"./preload-helper-be1680a6-1.js";import{r as u}from"./stimulus-helpers-17f3c993-1.js";import{E as h}from"./ez-base-controller-242f2ed1-1.js";import{O as c}from"./helpers-aaf8efb9-1.js";import{P as g}from"./partner-image-results-44e4b03d-1.js";import{sendTrackingEvent as o}from"./tracking-39df6e64-1.js";import{at as R,au as w}from"./actions-c6ee89d5-1.js";import"./performance-helpers-20b701c9-1.js";import"./js-5386754e-1.js";import"./_commonjsHelpers-de833af9-1.js";import"./init-user-58d04eb1-1.js";import"./index-fb2f77fe-1.js";class a extends h{constructor(){super(...arguments);r(this,"partnerClick",e=>{const{position:s}=e.target.dataset;o({element:e.target,data:{action:w,label:`Terms-${this.termsValue}`,value:parseInt(s,10)+1,content_type:`Content-${this.contentTypeValue}`}})});r(this,"handleNewResults",e=>{e.detail!=="END_OF_RESULTS"&&(window.clearTimeout(this.noResultTimer),window.addEventListener("scroll",this.loadNextResults))});r(this,"endLoadingResults",e=>{this.loadingResults=!1,this.removeLoadingIndicator(),e.detail==="END_OF_RESULTS"&&window.removeEventListener("scroll",this.loadNextResults)});r(this,"loadNextResults",()=>{if(c(".search-results",800)){const e=this.element.querySelectorAll("li").length,s=this.apiResultsWrapperTarget.getAttribute("data-total-count");this.loadingResults===!1&&e<s&&(this.partnerImageOptions.page+=1,this.getPartnerImageResults())}})}connect(){this.loadingResults=!1,this.waitForCondition(()=>{var e;return(e=window.partnerService)==null?void 0:e.ready()},()=>{window.partnerService.showDirect()?this.afterConnected():this.element.remove()})}afterConnected(){o({element:this.element,data:{action:R,label:`Terms-${this.termsValue}`,value:this.resultCountValue,content_type:`Content-${this.contentTypeValue}`,non_interaction:!0}}),this.searchTerm=this.apiResultsWrapperTarget.getAttribute("data-keyword"),this.partnerImages=new g(this.apiResultsWrapperTarget,this.searchTerm),this.partnerPlacement=this.element.getAttribute("data-partner-placement"),this.partnerImageOptions={page:0,placement:this.partnerPlacement,controllerElem:this.element,limit:this.apiResultsWrapperTarget.getAttribute("data-limit"),rowHeight:parseInt(this.apiResultsWrapperTarget.getAttribute("data-row-height"),10),maxRows:this.apiResultsWrapperTarget.getAttribute("data-max-rows"),padResults:!1,padWithTerm:this.apiResultsWrapperTarget.getAttribute("data-pad-with-term"),receivedResponse:e=>{const s=this.element.querySelector(".partner-justified-search__header"),{provider:n}=e;if(s&&n){const l=window.partnerService.partnerConfig(n);s.innerText=s.innerText.replace("{{partner}}",l.name)}}},this.getPartnerImageResults(),this.noResultTimer=setTimeout(()=>{this.element.querySelector(".ez-resource-thumb")||this.element.parentNode.removeChild(this.element)},this.noResultsDelay),window.addEventListener("resultsLoaded",this.handleNewResults,{once:!0}),window.addEventListener("resultsLoaded",this.endLoadingResults)}disconnect(){window.removeEventListener("resultsLoaded",this.handleNewResults,{once:!0}),window.removeEventListener("resultsLoaded",this.endLoadingResults),window.removeEventListener("scroll",this.loadNextResults)}getPartnerImageResults(){this.loadingResults=!0,this.addLoadingIndicator(),this.partnerImages.getResults(this.partnerImageOptions)}addLoadingIndicator(){this.loadingAnimTarget.classList.remove("is-hidden")}removeLoadingIndicator(){this.loadingAnimTarget.classList.add("is-hidden")}get noResultsDelay(){return 15*1e3}}r(a,"targets",["apiResultsWrapper","loadingAnim"]),r(a,"values",{contentType:String,terms:String,resultCount:Number});u([["partner-justified-search",a],["grid-partner-backfill",p(()=>import("./grid-partner-backfill-controller-1e04268d-1.js"),[])]]);
