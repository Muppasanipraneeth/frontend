import{r as a}from"./stimulus-helpers-17f3c993-1.js";import{E as p}from"./ez-base-controller-242f2ed1-1.js";import{sendTrackingEvent as l}from"./tracking-39df6e64-1.js";import{av as c}from"./actions-c6ee89d5-1.js";import{P as u}from"./partner-image-results-44e4b03d-1.js";import"./performance-helpers-20b701c9-1.js";import"./js-5386754e-1.js";import"./_commonjsHelpers-de833af9-1.js";import"./helpers-aaf8efb9-1.js";import"./init-user-58d04eb1-1.js";import"./index-fb2f77fe-1.js";const m="https://static.vecteezy.com/vite/assets/shutterstock-logo-52bdf4a4.svg";class n extends p{constructor(){super(...arguments),this.noResultTimer=null,this.clearNoResultsTimeout=e=>{e.detail!=="END_OF_RESULTS"&&window.clearTimeout(this.noResultTimer)},this.addMoreButtonHref=(e=null)=>{this.hasViewMoreButtonTarget&&(this.viewMoreButtonTarget.href=e.view_more_url)}}connect(){this.waitForCondition(()=>{var e;return(e=window.partnerService)==null?void 0:e.ready()},()=>{window.partnerService.showDirect()?this.afterConnected():this.element.remove()})}afterConnected(){this.searchTerm=this.apiResultsWrapperTarget.getAttribute("data-keyword"),this.resourceID=this.apiResultsWrapperTarget.getAttribute("data-resource-id"),this.getPartnerImageResults(),this.noResultTimer=setTimeout(()=>{this.element.querySelector(".ez-resource-thumb")||this.element.parentNode.removeChild(this.element)},this.noResultsDelay),window.addEventListener("resultsLoaded",this.clearNoResultsTimeout)}disconnect(){window.removeEventListener("resultsLoaded",this.clearNoResultsTimeout)}setLogo(e){const r=this.element.querySelector(".partner-logo-placeholder");if(r)if(e.logo_path){const t=new Image;t.src=`${new URL(Object.assign({"../../../../../frontend/components/partner/img/shutterstock-logo.svg":m})[`../../../../../frontend/components/partner/img/${e.logo_path}`],self.location)}`,t.alt=e.alt_text,t.classList.add("partner-sponsored-results__footer__partner-logo"),r.replaceWith(t)}else{const t=document.createElement("span");t.textContent=e.name,t.classList.add("partner-sponsored-results__footer__sponsored-text__partner-name"),r.replaceWith(t)}}setCouponInfo(e){e.percent?(this.couponCodeLinkTarget.innerHTML=this.couponCodeLinkTarget.innerHTML.replace(/{{coupon_percent}}/g,e.percent),this.couponCodeLinkTarget.classList.remove("is-hidden")):this.couponCodeLinkTarget.remove()}trackClick(e){l({element:this.element,data:{action:c,label:`Terms-${this.termsValue}`,partner_click_selection:e}})}get noResultsDelay(){return 15*1e3}partnerClick(){this.trackClick("Partner-Content")}revealPromoCode(e){e.preventDefault(),this.trackClick("Partner-Coupon"),this.makeCouponWindow(),window.location=this.makeCouponCodePartnerUrl()}makeCouponCodePartnerUrl(){return window.partnerService.couponUrl()}makeCouponWindow(){const e=window.open("","partner-sale","width=520,height=340"),{code:r,percent:t,expDate:o}=window.partnerService.couponInfo(this.partnerResponse),s=window.partnerService.partnerConfig(this.partnerResponse.provider),i=new URLSearchParams({code:r,percent:t,exp_date:o});e.location.href=`/${s.name.toLowerCase()}-coupons/coupon_code?${i.toString()}`}getPartnerImageResults(){new u(this.apiResultsWrapperTarget,this.searchTerm,this.addMoreButtonHref).getResults({controllerElem:this.element,page:this.apiResultsWrapperTarget.getAttribute("data-page"),placement:this.placementValue,limit:Number(this.apiResultsWrapperTarget.getAttribute("data-limit")),rowHeight:Number(this.apiResultsWrapperTarget.getAttribute("data-row-height")),maxRows:this.apiResultsWrapperTarget.getAttribute("data-max-rows"),padWithTerm:this.apiResultsWrapperTarget.getAttribute("data-pad-with-term"),backfillImageUrl:this.apiResultsWrapperTarget.getAttribute("data-backfill-image-url"),receivedResponse:r=>{this.partnerResponse=r;const{provider:t}=this.partnerResponse,o=window.partnerService.partnerConfig(t),s=window.partnerService.couponInfo(r);this.setLogo(o),this.setCouponInfo(s)}})}viewMoreClick(){this.trackClick("Partner-View More")}}n.targets=["apiResultsWrapper","couponCodeLink","viewMoreButton"];n.values={placement:String,terms:String};a([["partner-sponsored-results",n]]);
