var S=Object.defineProperty;var b=(s,e,t)=>e in s?S(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var h=(s,e,t)=>(b(s,typeof e!="symbol"?e+"":e,t),t);import{C as v,r as V}from"./stimulus-helpers-17f3c993-1.js";import{e as o}from"./events-8df5dda9-1.js";import{E as c}from"./ez-base-controller-242f2ed1-1.js";import{sendTrackingEvent as l,trackCompleteEvent as k,findCategoryByElement as d}from"./tracking-39df6e64-1.js";import{V as p,D as C,W as y,X as T,t as F,e as g,n as L}from"./helpers-aaf8efb9-1.js";import{a_ as A,af as B}from"./actions-c6ee89d5-1.js";import{C as f}from"./js-5386754e-1.js";import"./performance-helpers-20b701c9-1.js";import"./_commonjsHelpers-de833af9-1.js";import"./init-user-58d04eb1-1.js";class P extends v{constructor(){super(...arguments);h(this,"sendEvent",t=>{window.dataLayer.push({event:t.type})})}connect(){this.removeGTMListeners(),this.registerGTMListeners()}disconnect(){this.removeGTMListeners()}registerGTMListeners(){window.addEventListener(o.turbo.load,this.sendEvent,{once:!1})}removeGTMListeners(){window.removeEventListener(o.turbo.load,this.sendEvent,{once:!1})}}class _ extends c{track(e){const t={action:this.trackActionValue};this.hasTrackLabelValue&&(t.label=this.trackLabelValue),this.hasTrackValueValue&&(t.value=this.trackValueValue),Object.assign(t,this.processIncludedData());const a={data:t};this.sendFromElementValue&&(a.element=e.target),l(a),p("dev")&&this.deprecationWarning(this.trackActionValue,this.element)}trackComplete(e){k({action:this.completeActionValue,category:d(e.target)}),p("dev")&&this.deprecationWarning(this.completeActionValue,this.element)}deprecationWarning(e,t){console.warn(`This tracker is deprecated. Please upgrade ${e} to use Track Event Controller or Track Complete Event Controller. Target:`,t)}processIncludedData(){if(!this.hasIncludeDataValue)return{};const e={};return this.includeDataValue.split(",").map(a=>a.trim()).forEach(a=>{e[a]=this.element.dataset[a]}),e}}h(_,"values",{trackAction:String,completeAction:String,trackLabel:String,trackValue:String,includeData:String,sendFromElement:{type:Boolean,default:!0}});class E extends c{connect(){if(!this.hasActionValue)return;const e={action:this.actionValue};this.hasLabelValue&&(e.label=this.labelValue),this.hasValueValue&&(e.value=this.valueValue),Object.assign(e,this.processIncludedData());const t={data:e};this.sendFromBodyValue!==!0&&(t.element=this.element),l(t)}processIncludedData(){if(!this.hasIncludeDataValue)return{};const e={};return this.includeDataValue.split(",").map(a=>a.trim()).forEach(a=>{e[a]=this.element.dataset[a]}),e}}E.values={action:String,label:String,value:String,includeData:String,sendFromBody:{type:Boolean,default:!1}};class w extends c{connect(){if(this.hasConnectEventActionValue){const e={action:this.connectEventActionValue,sendFromBody:!1,params:null};this.track({currentTarget:this.element,params:e})}}track(e){const{action:t,label:a,value:r,sendFromBody:i=!1,...u}=e.params;if(t===void 0)return;const n={action:t};a!==void 0&&(n.label=a),r!==void 0&&(n.value=r),Object.assign(n,u),Object.assign(n,this.processIncludedData());const m={data:n};C(i)!==!0&&(m.element=e.currentTarget),l(m)}processIncludedData(){if(!this.hasIncludeDataValue)return{};const e={};return this.includeDataValue.split(",").map(a=>a.trim()).forEach(a=>{e[a]=this.element.dataset[y(a)]}),e}}w.values={includeData:String,connectEventAction:String};class I extends c{track(e){const{action:t,category:a,label:r,value:i,...u}=e.params;if(t===void 0)return;const n={action:t};r!==void 0&&(n.label=r),i!==void 0&&(n.value=i),a===void 0?n.category=d(e.target):n.category=a,Object.assign(n,u),k(n)}}class D extends c{constructor(){super(...arguments),this.sendFormFieldFocusEvent=e=>{const t=e.currentTarget.dataset.englishLabel;l({element:e.currentTarget,data:{action:A,category:d(e.currentTarget),label:`Field-${t}`}})},this.sendFormFieldErrorEvent=e=>{const t=e.dataset.englishLabel;l({element:e,data:{action:B,label:`Field-${t}`,category:d(e),error_trigger:"Error-Submission"}})}}connect(){this.hasErrorFieldTarget&&this.errorFieldTargets.forEach(e=>{this.sendFormFieldErrorEvent(e)})}}D.targets=["errorField"];class O extends c{connect(){}track(){const e=this.clickFormData();window.navigator.sendBeacon("/api/v2/tracking/clicks",e)}trackAnalytics(){const e=T(this.element.dataset.eventType,o);F(e,{})}clickFormData(){const e=new FormData;e.append(this.csrfParam,this.csrfToken);for(let t=0;t<this.element.attributes.length;t+=1){const a=this.element.attributes[t];if(a.name.match(/^data-/)){const r=a.name.replace("data-","").replace("-","_");["controller","action"].includes(r)||e.append(r,a.value)}}return e}normalizeParamName(e){return e.split(/(?=[A-Z])/).join("_").toLowerCase()}}class x extends v{constructor(){super(...arguments),this.sendSearchClick=e=>{const t=this.searchClickData(e);this.sendBeacon("/api/v2/tracking/search/clicks",t),window.localStorage.setItem(`resource-${e.detail.resourceId}`,JSON.stringify(t))},this.sendSponsoredSearchClick=e=>{const t=this.searchSponsoredClickData(e);this.sendBeacon("/api/v2/tracking/search/sponsored_clicks",t)},this.sendSearchDownload=e=>{const t=this.searchDownloadData(e);t&&this.sendBeacon("/api/v2/tracking/search/downloads",t)}}connect(){g()||(window.addEventListener(o.search.click,this.sendSearchClick),window.addEventListener(o.search.sponsored_click,this.sendSponsoredSearchClick),window.addEventListener(o.download_btn.initial_click,this.sendSearchDownload)),this.sendPageView()}disconnect(){window.removeEventListener(o.search.click,this.sendSearchClick),window.removeEventListener(o.search.sponsored_click,this.sendSponsoredSearchClick),window.removeEventListener(o.download_btn.initial_click,this.sendSearchDownload)}sendBeacon(e,t){if(document.body.getAttribute("data-env")==="test"){const r=f.get("searchEventsSent")||"[]",i=JSON.parse(r);i.push({url:e,data:t}),f.set("searchEventsSent",JSON.stringify(i),{domain:".example.com"});return}const a=new FormData;a.append(this.csrfParam,this.csrfToken),Object.keys(t).forEach(r=>{a.append(r,t[r])}),window.navigator.sendBeacon(e,a)}sendPageView(){L("search_tracking")&&this.isSearchResultsPage&&(g()||this.sendBeacon("/api/v2/tracking/search/pageviews",this.pageViewData))}get csrfParam(){const e=document.querySelector("meta[name=csrf-param]");return e?e.content:null}get csrfToken(){const e=document.querySelector("meta[name=csrf-token]");return e?e.content:null}get isSearchResultsPage(){return!!document.querySelector("[data-search-results-count]")}get pageViewData(){const e=["actual_free_results_shown_count","actual_pro_results_shown_count","algo_version","content_type","domain","filters_used","filter_params_json","guid","ignore","internal","locale","max_free_results_shown_count","max_pro_results_shown_count","page","pageview_guid","pro","referrer","results_count","split_test_name","split_test_variant","term","total_free_results","total_pro_results","type","user_guid","browser_language"],t={};return e.forEach(a=>{t[a]=this.element.getAttribute(`data-search-${a.replace(/_/g,"-")}`)||""}),t}searchClickData(e){const t=this.pageViewData;return t.resource_id=e.detail.resourceId,t.resource_position=e.detail.resourcePosition,t.resource_pro=e.detail.resourcePro,t}searchSponsoredClickData(e){const t=this.pageViewData;return t.resource_id=e.detail.resourceId,t.resource_position=e.detail.resourcePosition,t.resource_pro=e.detail.resourcePro,t.sponsored=e.detail.sponsored,t}searchDownloadData(e){if(!e.detail.guid)return null;const t={};return Object.entries(e.detail).forEach(([a,r])=>{t[a]=r}),t}}V([["google-tag-manager",P],["event-tracker",_],["track-trigger-event",E],["track-event",w],["track-complete-event",I],["form-analytics",D],["click-track",O],["search-analytics",x]]);
